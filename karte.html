<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Karte – dynamische Markergröße</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f5f5f5; color: #222; }
    header { background: #024; color: white; padding: 1rem; }
    nav a { color: white; margin-right: 1rem; text-decoration: none; font-weight: bold; }
    nav a:hover { text-decoration: underline; }
    main { padding: 2rem; max-width: 1000px; margin: auto; background: white; }
    h1 { color: #024; }
    #map { height: 600px; width: 100%; margin-top: 1rem; }
    footer { background: #eee; padding: 1rem; text-align: center; margin-top: 2rem; font-size: 0.9rem; color: #555; }
    input { padding: 0.25rem; font-size: 1rem; }
  </style>
  
</html>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([47.27, 9.4], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
  }).addTo(map);

  const markerLayer = L.layerGroup().addTo(map);

  function updateMap(fromYear, toYear) {
    fetch(`https://alpsteindb.onrender.com/api/eintraege-pro-gipfel?von=${fromYear}&bis=${toYear}`)
      .then(res => res.json())
      .then(data => {
        markerLayer.clearLayers();
        gipfel.forEach(p => {
          const count = data[p.Gipfel] || 0;
          const radius = count > 0 ? 10 + Math.log10(count) * 8.9 : 6;
          const color = count > 0 ? "green" : "gray";
          const marker = L.circleMarker([p.Latitude, p.Longitude], {
            radius,
            color,
            fillColor: color,
            fillOpacity: 0.7,
            weight: 1
          }).bindPopup(`${p.Gipfel} – ${count} Eintrag${count !== 1 ? 'e' : ''}`);
          markerLayer.addLayer(marker);
        });
      })
      .catch(err => {
        console.error("Fehler beim Laden der Daten:", err);
      });
  }

  updateMap(1990, 2025);
  document.getElementById('fromYear').addEventListener('change', () => {
    updateMap(fromYear.value, toYear.value);
  });
  document.getElementById('toYear').addEventListener('change', () => {
    updateMap(fromYear.value, toYear.value);
  });
</script>
</body>
