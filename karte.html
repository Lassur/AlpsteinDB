<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Karte – Alpstein DB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f5f5f5; color: #222; }
    header { background: #024; color: white; padding: 1rem; }
    nav a { color: white; margin-right: 1rem; text-decoration: none; font-weight: bold; }
    nav a:hover { text-decoration: underline; }
    main { padding: 2rem; max-width: 1000px; margin: auto; background: white; }
    h1 { color: #024; }
    #map { height: 600px; width: 100%; margin-top: 1rem; }
    footer { background: #eee; padding: 1rem; text-align: center; margin-top: 2rem; font-size: 0.9rem; color: #555; }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="index.html">Home</a>
      <a href="eintraege.html">Einträge</a>
      <a href="charts.html">Charts</a>
      <a href="karte.html" class="active">Karte</a>
      <a href="buecher.html">Bücher</a>
    </nav>
  </header>

  <main>
    <h1>Karte</h1>
    <div style="margin-top: 1rem; padding-bottom: 1rem;">
      <label><strong>Jahre filtern:</strong></label><br />
      <input id="fromYear" type="number" value="1990" min="1900" max="2100" style="width: 100px; margin-right: 1rem;" />
      <input id="toYear" type="number" value="2025" min="1900" max="2100" style="width: 100px;" />
    </div>
    <div id="map" style="height: 600px; width: 100%; margin-top: 1rem;"></div>
    <div id="map"></div>
  </main>

  <footer>
    &copy; 2025 Alpstein DB – Interaktive Visualisierung der Gipfel
  </footer>

  
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const gipfel = window.gipfel; // muss vorher im HTML als JS-Array vorhanden sein

var greenIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
  iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
});
var grayIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-grey.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
  iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
});

const map = L.map('map').setView([47.27, 9.4], 13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
  attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
}).addTo(map);

function updateMap(fromYear, toYear) {
  fetch(`https://alpsteindb.onrender.com/api/eintraege-pro-gipfel?von=${fromYear}&bis=${toYear}`)
    .then(res => res.json())
    .then(data => {
      map.eachLayer(layer => {
        if (layer instanceof L.Marker) map.removeLayer(layer);
      });
      gipfel.forEach(p => {
        const count = data[p.Gipfel] || 0;
        const icon = count > 0 ? greenIcon : grayIcon;
        const marker = L.marker([p.Latitude, p.Longitude], {icon}).addTo(map);
        marker.bindPopup(`${p.Gipfel} – ${count} Eintrag${count !== 1 ? 'e' : ''}`);
      });
    })
    .catch(err => console.error('Fehler beim Laden der Daten:', err));
}

updateMap(1990, 2025);

const fromInput = document.getElementById('fromYear');
const toInput = document.getElementById('toYear');
fromInput.addEventListener('change', () => updateMap(fromInput.value, toInput.value));
toInput.addEventListener('change', () => updateMap(fromInput.value, toInput.value));
</script>

</body></html>