
<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<title>Einträge – Alpstein DB</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet"/>
<style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f8f8f8; color: #333; }
    header { background: #024; color: white; padding: 1rem; }
    nav a { color: white; margin-right: 1rem; text-decoration: none; font-weight: bold; }
    nav a:hover { text-decoration: underline; }
    main { padding: 2rem; max-width: 95%; margin: auto; background: white; }
    footer { background: #eee; padding: 1rem; text-align: center; margin-top: 2rem; font-size: 0.9rem; color: #555; }
    h1 { color: #024; }
    #gipfeltabelle td, #gipfeltabelle th {
      font-size: 0.85rem;
      padding: 0.25rem 0.4rem;
    }
    .dataTable-pagination, .dataTable-info {
      font-size: 0.8rem;
    }
    select, button { margin-right: 10px; margin-bottom: 10px; }
    #exportButtons button { margin-right: 10px; }
  </style>
</head>
<body>
<header>
<nav>
<a href="index.html">Home</a>
<a class="active" href="eintraege.html">Einträge</a>
<a href="charts.html">Charts</a>
<a href="karte.html">Karte</a>
<a href="buecher.html">Bücher</a>
<a href="db.html">DB</a>
</nav>
</header>
<main>
<section>
<h2>Filter</h2>
<div class="filters">
<label for="gipfel">Gipfel:</label>
<select id="gipfel"><option value="">Alle</option></select>
<label for="route">Route:</label>
<select id="route"><option value="">Alle</option></select>
<label for="buch">Buch:</label>
<select id="buch"><option value="">Alle</option></select>
<label for="erstbegehung">Erstbegehung:</label>
<select id="erstbegehung"><option value="">Alle</option><option value="Ja">Ja</option><option value="Nein">Nein</option></select>
<label for="jahr_von">Jahr von:</label>
<input id="jahr_von" max="2100" min="1800" type="number"/>
<label for="jahr_bis">Jahr bis:</label>
<input id="jahr_bis" max="2100" min="1800" type="number"/>
<label for="wer">Wer:</label>
<input id="wer" placeholder="Suche nach Person..." type="text"/>
<label for="notiz">Notiz:</label>
<input id="notiz" placeholder="Suche in Notizen..." type="text"/>
<button onclick="loadData()">Filter anwenden</button>
</div>
</section>
<section>
<h2>Ergebnisse</h2>
<div>
<label for="entriesPerPage">Einträge pro Seite:</label>
<select id="entriesPerPage" onchange="loadData()">
<option selected="" value="10">10</option>
<option value="20">20</option>
<option value="50">50</option>
<option value="100">100</option>
</select>
</div>
<table border="1" id="resultsTable">
<thead>
<tr>
<th>Database_</th><th>Gipfel</th><th>Datum_JMT</th><th>Wer</th><th>Route</th>
<th>Notiz</th><th>Monat</th><th>Jahr</th><th>Buch</th><th>Erstbegehung</th>
</tr>
</thead>
<tbody></tbody>
</table>
<div id="pagination"></div>
</section>
</main>
<footer>
    © Andreas Koller, 2025 – <a href="mailto:andreas-koller@gmx.ch">andreas-koller@gmx.ch</a>
</footer>


<script>
let currentPage = 1;

async function loadData(page = 1) {
    currentPage = page;
    const gipfel = document.getElementById("gipfel").value;
    const route = document.getElementById("route").value;
    const buch = document.getElementById("buch").value;
    const erstbegehung = document.getElementById("erstbegehung").value;
    const jahrVon = document.getElementById("jahr_von").value;
    const jahrBis = document.getElementById("jahr_bis").value;
    const wer = document.getElementById("wer").value;
    const notiz = document.getElementById("notiz").value;
    const entries = document.getElementById("entriesPerPage").value;

    const params = new URLSearchParams({
        gipfel, route, buch, erstbegehung,
        jahrVon, jahrBis, wer, notiz,
        limit: entries,
        page
    });

    const res = await fetch(`/api/eintraege?${params.toString()}`);
    const data = await res.json();

    const tableBody = document.querySelector("#resultsTable tbody");
    tableBody.innerHTML = "";

    data.data.forEach(e => {
        const row = `<tr>
            <td>${e.Database_ || ""}</td>
            <td>${e.Gipfel || ""}</td>
            <td>${e.Datum_JMT ? new Date(e.Datum_JMT).toLocaleDateString() : ""}</td>
            <td>${e.Wer || ""}</td>
            <td>${e.Route || ""}</td>
            <td>${e.Notiz || ""}</td>
            <td>${e.Monat || ""}</td>
            <td>${e.Jahr || ""}</td>
            <td>${e.Buch || ""}</td>
            <td>${e.Erstbegehung || ""}</td>
        </tr>`;
        tableBody.innerHTML += row;
    });

    // Filter-Dropdowns aktualisieren
    updateDropdown("gipfel", data.filters.gipfel, gipfel);
    updateDropdown("route", data.filters.route, route);
    updateDropdown("buch", data.filters.buch, buch);
    updateDropdown("erstbegehung", data.filters.erstbegehung, erstbegehung);

    // Pagination aufbauen
    const totalPages = Math.ceil(data.total / entries);
    const paginationDiv = document.getElementById("pagination");
    paginationDiv.innerHTML = "";
    for (let i = 1; i <= totalPages && i <= 20; i++) {
        const btn = document.createElement("button");
        btn.innerText = i;
        btn.disabled = i === currentPage;
        btn.onclick = () => loadData(i);
        paginationDiv.appendChild(btn);
    }
}

function updateDropdown(id, values, selectedValue) {
    const select = document.getElementById(id);
    const current = select.value;
    select.innerHTML = '<option value="">Alle</option>';
    values?.sort().forEach(v => {
        const option = document.createElement("option");
        option.value = v;
        option.innerText = v;
        if (v === selectedValue) option.selected = true;
        select.appendChild(option);
    });
}

// Starte initial mit leerer Tabelle (keine automatische Anfrage)
document.addEventListener("DOMContentLoaded", () => {
    // Nur Dropdowns initial befüllen durch leere Anfrage
    loadData(1);
});
</script></body>
</html>
